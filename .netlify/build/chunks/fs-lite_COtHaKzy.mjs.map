{"version":3,"file":"fs-lite_COtHaKzy.mjs","sources":["../../../node_modules/unstorage/drivers/utils/index.mjs","../../../node_modules/unstorage/drivers/utils/node-fs.mjs","../../../node_modules/unstorage/drivers/fs-lite.mjs"],"sourcesContent":["export function defineDriver(factory) {\n  return factory;\n}\nexport function normalizeKey(key, sep = \":\") {\n  if (!key) {\n    return \"\";\n  }\n  return key.replace(/[:/\\\\]/g, sep).replace(/^[:/\\\\]|[:/\\\\]$/g, \"\");\n}\nexport function joinKeys(...keys) {\n  return keys.map((key) => normalizeKey(key)).filter(Boolean).join(\":\");\n}\nexport function createError(driver, message, opts) {\n  const err = new Error(`[unstorage] [${driver}] ${message}`, opts);\n  if (Error.captureStackTrace) {\n    Error.captureStackTrace(err, createError);\n  }\n  return err;\n}\nexport function createRequiredError(driver, name) {\n  if (Array.isArray(name)) {\n    return createError(\n      driver,\n      `Missing some of the required options ${name.map((n) => \"`\" + n + \"`\").join(\", \")}`\n    );\n  }\n  return createError(driver, `Missing required option \\`${name}\\`.`);\n}\n","import { existsSync, promises as fsPromises } from \"node:fs\";\nimport { resolve, dirname } from \"node:path\";\nfunction ignoreNotfound(err) {\n  return err.code === \"ENOENT\" || err.code === \"EISDIR\" ? null : err;\n}\nfunction ignoreExists(err) {\n  return err.code === \"EEXIST\" ? null : err;\n}\nexport async function writeFile(path, data, encoding) {\n  await ensuredir(dirname(path));\n  return fsPromises.writeFile(path, data, encoding);\n}\nexport function readFile(path, encoding) {\n  return fsPromises.readFile(path, encoding).catch(ignoreNotfound);\n}\nexport function stat(path) {\n  return fsPromises.stat(path).catch(ignoreNotfound);\n}\nexport function unlink(path) {\n  return fsPromises.unlink(path).catch(ignoreNotfound);\n}\nexport function readdir(dir) {\n  return fsPromises.readdir(dir, { withFileTypes: true }).catch(ignoreNotfound).then((r) => r || []);\n}\nexport async function ensuredir(dir) {\n  if (existsSync(dir)) {\n    return;\n  }\n  await ensuredir(dirname(dir)).catch(ignoreExists);\n  await fsPromises.mkdir(dir).catch(ignoreExists);\n}\nexport async function readdirRecursive(dir, ignore, maxDepth) {\n  if (ignore && ignore(dir)) {\n    return [];\n  }\n  const entries = await readdir(dir);\n  const files = [];\n  await Promise.all(\n    entries.map(async (entry) => {\n      const entryPath = resolve(dir, entry.name);\n      if (entry.isDirectory()) {\n        if (maxDepth === void 0 || maxDepth > 0) {\n          const dirFiles = await readdirRecursive(\n            entryPath,\n            ignore,\n            maxDepth === void 0 ? void 0 : maxDepth - 1\n          );\n          files.push(...dirFiles.map((f) => entry.name + \"/\" + f));\n        }\n      } else {\n        if (!(ignore && ignore(entry.name))) {\n          files.push(entry.name);\n        }\n      }\n    })\n  );\n  return files;\n}\nexport async function rmRecursive(dir) {\n  const entries = await readdir(dir);\n  await Promise.all(\n    entries.map((entry) => {\n      const entryPath = resolve(dir, entry.name);\n      if (entry.isDirectory()) {\n        return rmRecursive(entryPath).then(() => fsPromises.rmdir(entryPath));\n      } else {\n        return fsPromises.unlink(entryPath);\n      }\n    })\n  );\n}\n","import { existsSync, promises as fsp } from \"node:fs\";\nimport { resolve, join } from \"node:path\";\nimport { createError, createRequiredError, defineDriver } from \"./utils/index.mjs\";\nimport {\n  readFile,\n  writeFile,\n  readdirRecursive,\n  rmRecursive,\n  unlink\n} from \"./utils/node-fs.mjs\";\nconst PATH_TRAVERSE_RE = /\\.\\.:|\\.\\.$/;\nconst DRIVER_NAME = \"fs-lite\";\nexport default defineDriver((opts = {}) => {\n  if (!opts.base) {\n    throw createRequiredError(DRIVER_NAME, \"base\");\n  }\n  opts.base = resolve(opts.base);\n  const r = (key) => {\n    if (PATH_TRAVERSE_RE.test(key)) {\n      throw createError(\n        DRIVER_NAME,\n        `Invalid key: ${JSON.stringify(key)}. It should not contain .. segments`\n      );\n    }\n    const resolved = join(opts.base, key.replace(/:/g, \"/\"));\n    return resolved;\n  };\n  return {\n    name: DRIVER_NAME,\n    options: opts,\n    flags: {\n      maxDepth: true\n    },\n    hasItem(key) {\n      return existsSync(r(key));\n    },\n    getItem(key) {\n      return readFile(r(key), \"utf8\");\n    },\n    getItemRaw(key) {\n      return readFile(r(key));\n    },\n    async getMeta(key) {\n      const { atime, mtime, size, birthtime, ctime } = await fsp.stat(r(key)).catch(() => ({}));\n      return { atime, mtime, size, birthtime, ctime };\n    },\n    setItem(key, value) {\n      if (opts.readOnly) {\n        return;\n      }\n      return writeFile(r(key), value, \"utf8\");\n    },\n    setItemRaw(key, value) {\n      if (opts.readOnly) {\n        return;\n      }\n      return writeFile(r(key), value);\n    },\n    removeItem(key) {\n      if (opts.readOnly) {\n        return;\n      }\n      return unlink(r(key));\n    },\n    getKeys(_base, topts) {\n      return readdirRecursive(r(\".\"), opts.ignore, topts?.maxDepth);\n    },\n    async clear() {\n      if (opts.readOnly || opts.noClear) {\n        return;\n      }\n      await rmRecursive(r(\".\"));\n    }\n  };\n});\n"],"names":["fsPromises","fsp"],"mappings":"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","x_google_ignoreList":[0,1,2]}